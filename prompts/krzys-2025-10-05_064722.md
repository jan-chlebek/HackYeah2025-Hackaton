# Prompt

`POST /api/v1/reports` doesn't look like it allows an attachment being uploaded - check it. Also `GET /api/v1/reports/{id}` and `/api/v1/reports` do not show the attachment name - fix that.

Continue and fix unit tests and database seeding. Fix all issues

---

# Response

## Analysis

I analyzed the reports endpoints and found:

1. **POST `/api/v1/reports`** - ✅ Already accepts file uploads via `IFormFile` in the controller
2. **GET `/api/v1/reports/{id}`** - ❌ Missing `FileName` in the response DTO
3. **GET `/api/v1/reports`** - ❌ Missing `FileName` in the response DTO

The `Report` entity has a `FileName` field, and the service properly stores it, but the `ReportDto` was not exposing it.

## Changes Made

### 1. Added FileName to ReportDto
**File**: `backend/UknfCommunicationPlatform.Core/DTOs/Reports/ReportDto.cs`

Added a new property to expose the attachment filename:
```csharp
/// <summary>
/// Original uploaded file name (XLSX attachment)
/// </summary>
public string FileName { get; set; } = string.Empty;
```

### 2. Updated ReportsService Mappings
**File**: `backend/UknfCommunicationPlatform.Infrastructure/Services/ReportsService.cs`

Updated all three DTO mapping locations to include `FileName`:
- `GetReportsAsync()` - List endpoint
- `GetReportByIdAsync()` - Single report endpoint  
- `SubmitReportAsync()` - Create endpoint response

### 3. Updated Integration Tests
**File**: `backend/UknfCommunicationPlatform.Tests.Integration/Controllers/ReportsControllerTests.cs`

Added assertions to verify `FileName` is returned in responses:
- `SubmitReport_WithValidXlsxFile_CreatesReport` - Verifies filename in creation response
- `GetReports_ReturnsSubmittedReports` - Verifies filename in list
- `GetReports_WithFilter_ReturnsFilteredReports` - Verifies filename in filtered list

### 4. Updated Unit Tests
**File**: `backend/UknfCommunicationPlatform.Tests.Unit/Services/ReportsServiceTests.cs`

Added `FileName` assertions to:
- `GetReportByIdAsync_ExistingReport_ShouldReturnReport`
- `SubmitReportAsync_WithValidXlsxFile_ShouldCreateReport`

### 5. Database Seeding
**File**: `backend/UknfCommunicationPlatform.Infrastructure/Data/DatabaseSeeder.cs`

✅ Already properly populates `FileName` with meaningful values like `"raport_kwartalny_{period}_{year}.xlsx"`

## Test Results

### Integration Tests (ReportsControllerTests)
✅ **All 11 tests passed**
- SubmitReport_StoresDraftStatus
- SubmitReport_WithInvalidReportingPeriod_ReturnsBadRequest
- SubmitReport_WithNonXlsxFile_ReturnsBadRequest
- GetReports_WithFilter_ReturnsFilteredReports
- DownloadReport_WithValidId_ReturnsFile
- SubmitReport_WithValidXlsxFile_CreatesReport
- GetReports_ReturnsSubmittedReports
- DownloadReport_WithInvalidId_ReturnsNotFound
- SubmitReport_WithInvalidMimeType_ReturnsBadRequest
- SubmitReport_WithNoFile_ReturnsBadRequest
- SubmitReport_GeneratesUniqueReportNumbers

### Unit Tests (ReportsServiceTests)
✅ **All 20 tests passed**
- GetReportsAsync_ShouldIncludeEntityNameFromUser
- SubmitReportAsync_WithNonXlsxFile_ShouldThrowArgumentException
- GetReportFileAsync_ExistingReport_ShouldReturnFileData
- SubmitReportAsync_ShouldStoreFileContent
- GetReportsAsync_WithoutFilters_ShouldReturnAllReports
- SubmitReportAsync_ShouldGenerateUniqueReportNumber
- GetReportFileAsync_ReportWithEmptyFile_ShouldReturnNull
- GetReportFileAsync_NonExistingReport_ShouldReturnNull
- GetReportsAsync_WithReportingPeriodFilter_ShouldReturnFilteredReports
- GetReportsAsync_WithNonMatchingFilter_ShouldReturnEmpty
- SubmitReportAsync_WithInvalidMimeType_ShouldThrowArgumentException
- GetReportByIdAsync_NonExistingReport_ShouldReturnNull
- SubmitReportAsync_WithEmptyFile_ShouldThrowArgumentException
- SubmitReportAsync_WithValidXlsxFile_ShouldCreateReport
- GetReportsAsync_NoReportsInDatabase_ShouldReturnEmptyList
- GetReportsAsync_ShouldPopulateAllDtoFields
- GetReportsAsync_WithWhitespaceFilter_ShouldReturnAllReports
- SubmitReportAsync_WithFileTooLarge_ShouldThrowArgumentException
- SubmitReportAsync_WithNullFile_ShouldThrowArgumentException
- GetReportByIdAsync_ExistingReport_ShouldReturnReport

### Build Status
✅ **Build succeeded** with only 12 pre-existing nullable warnings (unrelated to this change)

## Summary

The reports endpoints now properly expose the attachment filename:
- ✅ POST `/api/v1/reports` - Already accepts file uploads
- ✅ GET `/api/v1/reports/{id}` - Now returns `fileName` in response
- ✅ GET `/api/v1/reports` - Now returns `fileName` for each report
- ✅ All tests passing (31 total: 11 integration + 20 unit)
- ✅ Database seeding already includes proper filenames
- ✅ No compilation errors

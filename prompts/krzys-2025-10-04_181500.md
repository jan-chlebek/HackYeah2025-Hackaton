# Prompt (2025-10-04 18:15:00, branch: krzys)

**User:**
Can you write full end to end sh script that performs deployment?

Here's what I've already executed:
az acr create --resource-group "HackYeah2025" --name "hackyeah2025chlebkiacr" --sku Basic
az acr login --name "hackyeah2025chlebkiacr"

docker build -t hackyeah2025chlebkiacr.azurecr.io/uknf-backend:latest ./backend
docker push hackyeah2025chlebkiacr.azurecr.io/uknf-backend:latest

docker build -t hackyeah2025chlebkiacr.azurecr.io/uknf-frontend:latest ./frontend
docker push hackyeah2025chlebkiacr.azurecr.io/uknf-frontend:latest

az deployment group create --resource-group "HackYeah2025" --template-file azure-deploy/main.bicep --parameters acrName="hackyeah2025chlebkiacr" backendAppName="hackyeah2025chlebkiknfbackend" frontendAppName="hackyeah2025chlebkiknffrontend" dbAdminPassword="yeah2025!"

**Copilot:**
I've created comprehensive deployment scripts for both Bash and PowerShell that automate the entire Azure deployment process end-to-end.

## Files Created:

1. **`azure-deploy/deploy-to-azure.sh`** - Full Bash deployment script
2. **`azure-deploy/deploy-to-azure.ps1`** - Full PowerShell deployment script
3. **`azure-deploy/QUICK_REFERENCE.md`** - Quick reference guide with common commands
4. **Updated `azure-deploy/README.md`** - Complete documentation with manual and automated deployment options

## What the Scripts Do:

The deployment scripts automate the following steps:

1. **Ensure Resource Group Exists** - Creates if needed
2. **Create/Verify ACR** - Creates Azure Container Registry and enables admin user
3. **Build and Push Images** - Builds both backend and frontend Docker images and pushes to ACR
4. **Deploy Infrastructure** - Uses Bicep template to deploy:
   - Azure Container Registry
   - PostgreSQL Flexible Server
   - App Service Plans (2x B1)
   - Web Apps for backend and frontend
5. **Configure Web Apps** - Sets container images and ACR credentials
6. **Restart Web Apps** - Restarts to pull the latest images
7. **Configure PostgreSQL Firewall** - Allows Azure services to connect
8. **Display Results** - Shows all URLs and next steps

## Usage:

### Bash (Linux/macOS/WSL):
```bash
bash azure-deploy/deploy-to-azure.sh
```

### PowerShell (Windows):
```powershell
.\azure-deploy\deploy-to-azure.ps1
```

## Key Features:

- ✅ Idempotent - Can be run multiple times safely
- ✅ Error handling with `set -e` (Bash) and `$ErrorActionPreference = "Stop"` (PowerShell)
- ✅ Colored output for better readability
- ✅ Automatic path resolution (works from any directory)
- ✅ Parallel Web App restarts for faster deployment
- ✅ Verification steps (lists ACR images, checks deployment status)
- ✅ Complete resource URLs and management commands in output

## After Deployment:

Your apps will be available at:
- **Backend API**: `https://hackyeah2025chlebkiknfbackend.azurewebsites.net`
- **Swagger**: `https://hackyeah2025chlebkiknfbackend.azurewebsites.net/swagger`
- **Frontend**: `https://hackyeah2025chlebkiknffrontend.azurewebsites.net`

## Cost Estimate:
~$43/month for all resources (Basic SKUs in Poland Central)

## Next Steps:
1. Run database migrations via SSH or deployment slot
2. Configure custom domains if needed
3. Set up CI/CD using the provided GitHub Actions sample
4. Review security settings for production use

The scripts are production-ready but include notes about security improvements for production environments (managed identities, specific IP firewall rules, secure password management).

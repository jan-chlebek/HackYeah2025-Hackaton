# Prompt: Deploy Docker and Check Swagger - Fix Swagger Not Working

**Date:** 2025-10-05 06:37:21
**Branch:** krzys
**User Request:** deploy docker and check swagger - it is not working.

## Context
The user reported that Swagger documentation was not working in the deployed Docker environment. The backend containers were already running but Swagger was failing to generate the API documentation.

## Problem Analysis
Upon investigation, the following error was identified in the backend logs:

```
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - UknfCommunicationPlatform.Api.Controllers.v1.ReportsController.SubmitReport
---> SwaggerGeneratorException: Error reading parameter(s) for action as [FromForm] attribute used with IFormFile.
Please refer to https://github.com/domaindrivendev/Swashbuckle.AspNetCore#handle-forms-and-file-uploads
```

The issue was in the `ReportsController.SubmitReport` endpoint which used individual `[FromForm]` parameters with `IFormFile`:
```csharp
public async Task<ActionResult<ReportDto>> SubmitReport(
    [FromForm] IFormFile file,
    [FromForm] string reportingPeriod)
```

Swashbuckle/Swagger doesn't handle individual `[FromForm]` parameters with `IFormFile` properly - it requires them to be wrapped in a model class.

## Solution Implemented

### 1. Created Form Model Class
Created `/backend/UknfCommunicationPlatform.Api/Models/SubmitReportFormModel.cs`:
```csharp
using Microsoft.AspNetCore.Http;
using System.ComponentModel.DataAnnotations;

namespace UknfCommunicationPlatform.Api.Models;

public class SubmitReportFormModel
{
    [Required]
    public IFormFile File { get; set; } = null!;

    [Required]
    public string ReportingPeriod { get; set; } = null!;
}
```

### 2. Updated Swagger Configuration
Added `MapType` configuration and operation filter in `Program.cs`:
```csharp
options.MapType<IFormFile>(() => new Microsoft.OpenApi.Models.OpenApiSchema
{
    Type = "string",
    Format = "binary"
});

options.OperationFilter<UknfCommunicationPlatform.Api.Filters.FileUploadOperationFilter>();
```

### 3. Created Operation Filter
Created `/backend/UknfCommunicationPlatform.Api/Filters/FileUploadOperationFilter.cs` to properly document file upload endpoints in Swagger with multipart/form-data support.

### 4. Updated ReportsController
Modified the `SubmitReport` endpoint to use the form model:
```csharp
public async Task<ActionResult<ReportDto>> SubmitReport(
    [FromForm] Models.SubmitReportFormModel model)
{
    // Updated to use model.File and model.ReportingPeriod
    var report = await _reportsService.SubmitReportAsync(currentUserId, model.File, request);
    // ...
}
```

## Results
- ✅ Docker containers deployed and running successfully
- ✅ Backend listening on http://0.0.0.0:8080 (exposed as http://localhost:5000)
- ✅ Swagger UI accessible at http://localhost:5000/swagger
- ✅ Swagger JSON generated successfully without errors (HTTP 200)
- ✅ All API endpoints properly documented including file upload endpoints

## Commands Used
```bash
# Check container status
docker-compose -f docker-compose.dev.yml ps

# Restart backend container
docker-compose -f docker-compose.dev.yml restart backend

# Check backend logs
docker logs uknf-backend-dev --tail 50

# Verify Swagger accessibility
curl -s -o /dev/null -w "%{http_code}" http://localhost:5000/swagger/index.html
```

## Files Modified
1. `/backend/UknfCommunicationPlatform.Api/Models/SubmitReportFormModel.cs` - Created
2. `/backend/UknfCommunicationPlatform.Api/Filters/FileUploadOperationFilter.cs` - Created
3. `/backend/UknfCommunicationPlatform.Api/Program.cs` - Updated Swagger configuration
4. `/backend/UknfCommunicationPlatform.Api/Controllers/v1/ReportsController.cs` - Updated SubmitReport method

## Key Learnings
- Swashbuckle/Swagger requires `IFormFile` parameters to be wrapped in a model class when using `[FromForm]` binding
- The `MapType` configuration helps Swagger understand how to represent `IFormFile` in the OpenAPI schema
- Operation filters can be used to customize how specific endpoints are documented in Swagger
- Using a form model class is cleaner and more maintainable than individual form parameters

## Testing Verification
- Swagger UI loads successfully in browser
- No exceptions in backend logs after changes
- API returns HTTP 200 for swagger/index.html
- Backend application started successfully with all migrations applied

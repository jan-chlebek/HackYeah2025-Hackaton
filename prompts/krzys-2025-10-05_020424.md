# Prompt

/api/v1/messages/{id}/cancel - remove this API - it is unneeded. There is no need for draft messages, only full message are sent, there are no drafts. Remove the draft messages.

# Response

I have successfully removed all draft message functionality and the cancel endpoint from the UKNF Communication Platform. Here's a summary of the changes made:

## Removed Endpoints

1. **POST /api/v1/messages/{id}/cancel** - Cancel message endpoint (completely removed)
2. **POST /api/v1/messages/{id}/send** - Send draft endpoint (completely removed)
3. **PUT /api/v1/messages/{id}** - Update draft message endpoint (completely removed)
4. **DELETE /api/v1/messages/{id}** - Delete draft endpoint (completely removed)

## Modified Endpoints

1. **POST /api/v1/messages** - Now always creates and sends messages immediately
   - Removed `SendImmediately` parameter
   - Recipient is now always required
   - Messages are always created with `Status = Sent`

## Code Changes

### DTOs Updated
- **CreateMessageRequest.cs**: Removed `SendImmediately` property
- **SendDraftRequest.cs**: Deleted file entirely
- **MessageStatsResponse**: Removed `TotalDrafts` property

### Enums Simplified
- **MessageStatus**: Removed `Draft` (0) and `Cancelled` (6) values
  - Now only has: Sent, Read, AwaitingUknfResponse, AwaitingUserResponse, Closed
- **MessageFolder**: Removed `Drafts` (2) value
  - Now only has: Inbox, Sent, Reports, Cases, Applications

### Service Layer Updated
- **MessageService.cs**:
  - Modified `CreateMessageAsync` to always set Status = Sent and SentAt = UtcNow
  - Removed `UpdateMessageAsync` method
  - Removed `SendDraftAsync` method
  - Removed `CancelMessageAsync` method
  - Removed `DeleteDraftAsync` method
  - Updated `GetMessageStatsAsync` to remove TotalDrafts calculation
  - Updated status string mapping to remove Draft and Cancelled translations

### Controller Updated
- **MessagesController.cs**: Removed all draft and cancel-related endpoints
- Simplified CreateMessage validation (recipient always required)

### Tests Updated
- **MessageServiceTests.cs**: 
  - Removed `CreateMessageAsync_AsDraft_ShouldCreateDraft` test
  - Removed `UpdateMessageAsync_WithDraft_ShouldUpdateMessage` test
  - Removed `UpdateMessageAsync_WithSentMessage_ShouldReturnNull` test
  - Removed `SendDraftAsync_WithDraft_ShouldSendMessage` test
  - Removed `CancelMessageAsync_WithUnreadMessage_ShouldCancelMessage` test
  - Removed `CancelMessageAsync_WithReadMessage_ShouldReturnFalse` test
  - Removed `DeleteDraftAsync_WithDraft_ShouldDeleteMessage` test
  - Removed `DeleteDraftAsync_WithSentMessage_ShouldReturnFalse` test
  - Updated `GetMessageStatsAsync_ShouldReturnCorrectStats` to remove TotalDrafts assertion
  - Updated `SeedMessagesAsync` to remove draft message seeding
  - Updated `CreateMessageAsync_WithValidData_ShouldCreateMessage` to remove SendImmediately

## Test Results

All tests are passing:
- ✅ Backend Unit Tests: 134/134 passed
- ✅ Backend Integration Tests: 20/20 passed
- ✅ **Total: 154/154 tests passed**

## Impact Summary

The application has been simplified by removing the draft message concept entirely:
- Messages can only be created in the "Sent" state
- No ability to save messages as drafts for later sending
- No ability to cancel sent messages
- No ability to update or delete drafts
- Cleaner, simpler message workflow: Create → Send (atomic operation)

All database queries have been automatically updated by removing references to cancelled messages and draft status filtering. The system is now production-ready with the simplified messaging workflow.

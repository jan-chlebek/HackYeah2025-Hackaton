# Prompt: Create Plan for Cases + Analyze Messages UI Requirements

**Date**: 2025-10-05_052821
**Branch**: krzys
**User**: quasar

---

## User Prompt

```
Okay crate plan to add cases and save to files. Then analyze ui requirements for the messages backend
```

---

## Context

The user requested two tasks:
1. Create an implementation plan for Cases/Access Requests (Wnioski) system
2. Analyze UI requirements for Messages backend based on mockups and specs

This follows previous conversation where:
- User clarified that "Cases" are actually "Access Requests" (registration requests for system access)
- User asked for field enumeration of Access Request UI
- Messages API is partially implemented (60% complete - 8/14 endpoints)

---

## Agent Response

### Task 1: Cases Implementation Plan

Created comprehensive implementation plan document: `CASES_IMPLEMENTATION_PLAN.md`

**Key Decisions**:
- Keep unified Case entity with `CaseType` enum (AccessRequest, Investigation, Audit, etc.)
- Use Flags enum for permissions (Reporting, Cases, EntityAdmin, DocumentLibrary, Announcements)
- Implement full state machine (Working → New → Accepted/Blocked/Updated)
- Include applicant snapshot data for audit trail

**Structure**:
- 6 implementation phases (Entity updates, DTOs, Service, Controller, Tests, Seeding)
- 18 API endpoints total (CRUD, state transitions, documents, messages, stats)
- 20+ integration tests
- Time estimate: 18-25 hours full implementation, 8-10 hours MVP

**Files to Create/Modify**:
- Update `Case.cs` entity with access request fields
- New enums: `CaseType`, `RequestedPermission`
- 15+ DTOs in `DTOs/Cases/` directory
- New `CaseService.cs` with 18+ methods
- New `CasesController.cs` with 18 endpoints
- New `CasesControllerTests.cs` with 20+ tests
- Update `DatabaseSeeder.cs` with sample cases

### Task 2: Messages UI Requirements Analysis

Created comprehensive UI analysis document: `MESSAGES_UI_REQUIREMENTS_ANALYSIS.md`

**Key Findings**:

**UI Screens Analyzed**:
- Screen 05: Wiadomości (Messages List) - Split view with list + preview
- Screen 06: Wiadomości filtrowanie - Three-column layout with advanced filters
- Screen 07: Wiadomości szczegóły - Full message thread view with replies

**Current Status**:
- ✅ Implemented (60%): List, Details, Create, Read tracking, Stats, Download
- ❌ Missing (40%): Star, Archive, Delete, Reply, Forward, Thread view, Advanced filters, Bulk ops, Export

**Missing API Endpoints Identified** (6 endpoints):
1. `POST /api/v1/messages/{id}/reply` - Reply to message
2. `POST /api/v1/messages/{id}/forward` - Forward message
3. `POST /api/v1/messages/{id}/star` - Toggle star/favorite
4. `POST /api/v1/messages/{id}/archive` - Archive message
5. `DELETE /api/v1/messages/{id}` - Delete draft
6. `GET /api/v1/messages/{id}/thread` - Get full thread
7. `POST /api/v1/messages/send-bulk` - Send to multiple recipients
8. `GET /api/v1/messages/export` - Export to CSV/Excel

**UI Features Requiring Backend Support**:
- Filter tabs: All, Unread, Starred, Sent, Archive
- Advanced filters: Date range, Sender, Type, Priority, Attachments
- Message types: System, Notification, Entity, Internal
- Priority levels: High, Normal, Low
- Threading: Parent/child relationships, reply chains
- Bulk operations: Archive multiple, star multiple, delete multiple
- Rich text support: HTML storage and rendering
- Attachment handling: Multiple files, ZIP download
- Read receipts: Track who read when

**Implementation Phases** (6 phases, 20-28 hours):
1. Core features (Star, Archive, Delete) - 4-6h
2. Threading & Reply - 6-8h
3. Advanced Filtering - 2-3h
4. Bulk Operations - 3-4h
5. Export & Reporting - 2-3h
6. Integration Tests - 3-4h

**Polish UI Field Mappings**:
- Comprehensive translation table for all UI labels
- Examples: Wiadomości → Messages, Nieprzeczytane → Unread, etc.

### Files Created

1. **CASES_IMPLEMENTATION_PLAN.md** (374 lines)
   - Complete implementation roadmap
   - Entity/DTO/Service/Controller specifications
   - Test scenarios
   - Time estimates
   - File structure summary

2. **MESSAGES_UI_REQUIREMENTS_ANALYSIS.md** (658 lines)
   - Detailed UI screen analysis
   - Backend data requirements
   - API endpoint inventory
   - DTO specifications
   - Implementation checklist
   - Priority matrix
   - Polish translations

### Approach

**Research Phase**:
1. Read UI_SCREENS_SUMMARY.md for mockup descriptions
2. Read DETAILS_UKNF_Prompt2Code2.md for detailed requirements
3. Examined existing entity models (Case.cs, Message.cs)
4. Analyzed current API implementation status

**Analysis Phase**:
1. Identified gaps between UI mockups and current backend
2. Enumerated all UI fields and actions requiring backend support
3. Mapped UI features to API endpoints and DTOs
4. Categorized missing features by priority

**Documentation Phase**:
1. Created structured implementation plans with phases
2. Specified exact entity fields, DTOs, and methods needed
3. Provided time estimates and priorities
4. Included Polish UI translations for frontend integration

### Key Insights

**For Cases/Access Requests**:
- Existing Case entity has general fields but missing access-request-specific fields
- Need permission checkboxes (Flags enum approach recommended)
- Workflow requires state machine validation (Working → New → Accepted/Blocked)
- Communication within cases (messages) needs separate handling
- Applicant data should be snapshot at creation time (not reference User directly)

**For Messages**:
- UI mockups show 3 distinct screens with different feature requirements
- Threading is critical but not yet implemented
- Advanced filtering has 6 filter categories (Status, Date, Sender, Type, Attachments, Priority)
- Bulk operations are shown in UI but not in backend
- Polish translations are essential for all labels

**Implementation Priorities**:
1. Cases: MVP state transitions first (Working → New → Accepted) before advanced features
2. Messages: Reply + Star + Archive are highest priority (visible in all 3 UI screens)
3. Both: Integration tests critical to prevent regressions

### Next Steps

**Recommended Order**:
1. **Messages Phase 1** (4-6h): Implement Star, Archive, Delete - these are visible everywhere in UI
2. **Messages Phase 2** (6-8h): Implement Reply and Thread - core communication features
3. **Cases MVP** (8-10h): Entity updates, core CRUD, state transitions
4. **Messages Phase 3** (2-3h): Advanced filtering to match UI Screen 06
5. **Cases Full** (10-15h): Documents, messages, history, full workflow

**Awaiting User Decision**:
- Which feature to implement first: Messages completion or Cases MVP?
- Should Cases and AccessRequests be separate entities or unified with CaseType?
- Priority for authentication re-enablement vs feature completion?

---

## Tools Used

1. `create_file` - Created CASES_IMPLEMENTATION_PLAN.md
2. `read_file` - Read UI_SCREENS_SUMMARY.md (screens 00-07)
3. `grep_search` - Searched for message-related terms in requirements
4. `read_file` - Read DETAILS_UKNF_Prompt2Code2.md (pages 10-11, 22-24, 33-35)
5. `create_file` - Created MESSAGES_UI_REQUIREMENTS_ANALYSIS.md
6. `run_in_terminal` - Get timestamp for prompt filename
7. `create_file` - This prompt documentation file

---

## Outcome

✅ **Success**: Created two comprehensive analysis documents ready for implementation

**Deliverables**:
- CASES_IMPLEMENTATION_PLAN.md - 374 lines, 6 phases, 18-25 hour estimate
- MESSAGES_UI_REQUIREMENTS_ANALYSIS.md - 658 lines, 6 phases, 20-28 hour estimate
- Both documents include:
  - Detailed specifications
  - Entity/DTO/API designs
  - Test scenarios
  - Time estimates
  - Priority matrices
  - Polish translations

**Value**:
- Clear roadmap for implementing both features
- No ambiguity about what needs to be built
- Time estimates help with sprint planning
- Test scenarios ensure quality
- Polish translations ensure frontend compatibility

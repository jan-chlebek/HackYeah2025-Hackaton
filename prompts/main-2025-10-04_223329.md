# Prompt: Connect Wiadomosci to API Endpoint

**Date:** 2025-10-04 22:33:29  
**Branch:** main

## User Request

I want you to change displaying wiadomosci - instead of static data, display them from endpoint http://localhost:5000/api/v1/messages. Example results are:
```json
{"data":[{"id":3,"subject":"Harmonogram kontroli","body":"Informujemy o zaplanowanej kontroli w dniach 20-22 stycznia 2025.","sender":{"id":2,"email":"jan.kowalski@uknf.gov.pl","firstName":"Jan","lastName":"Kowalski","fullName":"Jan Kowalski"},"recipient":{"id":3,"email":"kontakt@pkobp.pl","firstName":"Przedstawiciel","lastName":"PKO Bank Polski S.A.","fullName":"Przedstawiciel PKO Bank Polski S.A."},"status":1,"folder":1,"threadId":null,"parentMessageId":null,"isRead":false,"sentAt":"2025-10-03T20:08:15.409063Z","readAt":null,"relatedEntityId":null,"relatedEntityName":null,"relatedReportId":null,"relatedCaseId":null,"attachmentCount":0,"replyCount":0,"isCancelled":false,"cancelledAt":null},{"id":2,"subject":"Raport kwartalny - dostarczone","body":"W załączeniu przesyłamy żądany raport finansowy za IV kwartał 2024.","sender":{"id":3,"email":"kontakt@pkobp.pl","firstName":"Przedstawiciel","lastName":"PKO Bank Polski S.A.","fullName":"Przedstawiciel PKO Bank Polski S.A."},"recipient":{"id":2,"email":"jan.kowalski@uknf.gov.pl","firstName":"Jan","lastName":"Kowalski","fullName":"Jan Kowalski"},"status":1,"folder":0,"threadId":null,"parentMessageId":null,"isRead":false,"sentAt":"2025-10-01T20:08:15.409063Z","readAt":null,"relatedEntityId":null,"relatedEntityName":null,"relatedReportId":null,"relatedCaseId":null,"attachmentCount":0,"replyCount":0,"isCancelled":false,"cancelledAt":null},{"id":1,"subject":"Prośba o przesłanie raportu kwartalnego","body":"Uprzejmie prosimy o przesłanie raportu finansowego za IV kwartał 2024 roku zgodnie z wymogami regulacyjnymi.","sender":{"id":2,"email":"jan.kowalski@uknf.gov.pl","firstName":"Jan","lastName":"Kowalski","fullName":"Jan Kowalski"},"recipient":{"id":3,"email":"kontakt@pkobp.pl","firstName":"Przedstawiciel","lastName":"PKO Bank Polski S.A.","fullName":"Przedstawiciel PKO Bank Polski S.A."},"status":1,"folder":1,"threadId":null,"parentMessageId":null,"isRead":true,"sentAt":"2025-09-29T20:08:15.408948Z","readAt":"2025-09-30T20:08:15.409014Z","relatedEntityId":null,"relatedEntityName":null,"relatedReportId":null,"relatedCaseId":null,"attachmentCount":0,"replyCount":0,"isCancelled":false,"cancelledAt":null}],"pagination":{"page":1,"pageSize":20,"totalCount":3,"totalPages":1}}
```

## Response Summary

I successfully connected the wiadomosci (messages) component to the real API endpoint. Here's what was implemented:

### Changes Made

1. **Added HttpClient Configuration** (`app.config.ts`)
   - Added `provideHttpClient(withFetch())` to enable HTTP requests in the Angular application

2. **Created Message Service** (`message.service.ts`)
   - Created a new service to handle API calls to `http://localhost:5000/api/v1/messages`
   - Defined TypeScript interfaces matching the backend API response structure:
     - `MessageUser` - for sender/recipient data
     - `Message` - for message data with all fields
     - `MessagePagination` - for pagination metadata
     - `MessageResponse` - for the complete API response
   - Implemented methods:
     - `getMessages(page, pageSize)` - fetch paginated messages
     - `getMessageById(id)` - fetch a single message by ID

3. **Updated Component** (`wiadomosci-list.component.ts`)
   - Replaced static data with API calls
   - Injected `MessageService` using the new `inject()` function
   - Updated type definitions for sorting columns to match API structure
   - Implemented `loadMessages()` method to fetch data from API
   - Updated filtering logic to work with new API data structure:
     - Filter by subject, sender name, recipient name
     - Filter by status and read/unread state
     - Filter by date range
   - Added loading and error states
   - Implemented helper methods:
     - `formatDate()` - format ISO dates to Polish locale
     - `getStatusText()` - map status numbers to readable text
     - `getFolderText()` - map folder numbers to readable text
   - Updated pagination to use server-side pagination data

4. **Updated HTML Template** (`wiadomosci-list.component.html`)
   - Replaced old filter fields with new ones matching API structure:
     - Subject (Temat)
     - Sender (Nadawca)
     - Recipient (Odbiorca)
     - Status
     - Sent date range
     - Unread only filter
   - Updated table columns to display API data:
     - ID, Subject, Sender, Recipient, Status, Sent Date, Is Read, Attachment Count, Reply Count
   - Added loading state UI ("Ładowanie wiadomości...")
   - Added error state UI for failed API calls
   - Added action buttons in each row to view message details
   - Removed the separate action section at the bottom

5. **Updated CSS Styles** (`wiadomosci-list.component.css`)
   - Added styles for loading state
   - Added styles for error state
   - Added styling for unread messages (bold font, light blue background)
   - Added styles for the "Zobacz" (View) button in table rows
   - Updated dark theme support for new elements

### Key Features

- **Real-time data loading** from backend API
- **Server-side pagination** support
- **Loading and error states** for better UX
- **Visual distinction** for unread messages
- **Responsive filtering** with multiple criteria
- **Date formatting** in Polish locale
- **Status and folder text mapping** for better readability
- **Accessibility** maintained with proper ARIA labels

### API Integration Details

- **Endpoint:** `http://localhost:5000/api/v1/messages`
- **Method:** GET
- **Query Parameters:** 
  - `page` (default: 1)
  - `pageSize` (default: 20)
- **Response Structure:** Matches the provided example with `data` array and `pagination` object

### Testing Notes

The component now:
- Fetches data on initialization
- Displays loading state while fetching
- Shows error message if API call fails
- Displays messages in a table with proper formatting
- Supports client-side filtering on fetched data
- Supports pagination (server-side)
- Allows viewing message details by clicking "Zobacz" button

### Files Modified

1. `frontend/uknf-project/src/app/app.config.ts`
2. `frontend/uknf-project/src/app/services/message.service.ts` (new)
3. `frontend/uknf-project/src/app/features/wiadomosci/wiadomosci-list/wiadomosci-list.component.ts`
4. `frontend/uknf-project/src/app/features/wiadomosci/wiadomosci-list/wiadomosci-list.component.html`
5. `frontend/uknf-project/src/app/features/wiadomosci/wiadomosci-list/wiadomosci-list.component.css`

### No Compilation Errors

All TypeScript files compile successfully with no errors.

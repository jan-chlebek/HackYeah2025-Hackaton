# Fix Invisible Buttons on Table Row Hover

**Date**: 2025-10-05 04:43:44  
**Branch**: FrontendNG  
**Component**: library-list, messages-list

## User Report

"In library list, download button onhover of table row stops being visible"

## Problem Analysis

When hovering over a table row in high contrast mode, the download button became invisible due to a CSS specificity issue:

### Root Cause

The table row hover styles included a wildcard selector that forced ALL child elements to black color:

```css
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover * {
  color: #000000 !important;
}
```

**What Happened:**
1. Row hover applies yellow background (#FFFF00)
2. Wildcard `*` forces all children to black text (#000000)
3. Buttons default to black background + black text = **invisible**
4. User cannot see or interact with action buttons

### Visual Issue

```
Before Fix:
┌─────────────────────────────────────────┐
│ Yellow Row (on hover)                   │
│ Black Text │ [Black Button - INVISIBLE] │  ← Button blends into nothing
└─────────────────────────────────────────┘
```

## Solution Implemented

Added explicit button styling rules that override the wildcard selector, ensuring buttons remain visible with proper contrast on hovered rows.

### New CSS Rules

```css
/* High Contrast - Keep buttons visible on row hover */
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover button,
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover .p-button {
  background-color: #000000 !important;
  color: #FFFF00 !important;
  border: 2px solid #000000 !important;
}

html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover button *,
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover .p-button * {
  color: #FFFF00 !important;
}

/* High Contrast - Button hover within row hover */
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover button:hover,
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover .p-button:hover {
  background-color: #000000 !important;
  color: #FFFF00 !important;
  border: 2px solid #000000 !important;
  transform: scale(1.05);
}

html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover button:hover *,
html.high-contrast :host ::ng-deep .p-datatable .p-datatable-tbody > tr:hover .p-button:hover * {
  color: #FFFF00 !important;
}
```

### How It Works

**CSS Specificity Chain:**
1. **Row hover** sets yellow background: `tr:hover` 
2. **Wildcard** tries to set black text: `tr:hover *`
3. **Button override** wins with higher specificity: `tr:hover button` ✓
4. **Button hover** adds scale effect for interactivity

**Result:**
```
After Fix:
┌─────────────────────────────────────────┐
│ Yellow Row (on hover)                   │
│ Black Text │ [Black bg + Yellow text]  │  ← Button clearly visible
│            │ [  "Pobierz" button    ]  │
└─────────────────────────────────────────┘
```

## Visual Design

### Button States on Hovered Row

| State | Background | Text | Border | Effect |
|-------|-----------|------|--------|--------|
| Normal (row not hovered) | Black | Yellow | 2px yellow | - |
| Row hovered, button not hovered | Black | Yellow | 2px black | Visible contrast against yellow row |
| Row + button hovered | Black | Yellow | 2px black | `scale(1.05)` - slight grow |

### Contrast Ratios

- **Yellow row background + Black button**: Strong visual separation
- **Black button background + Yellow text**: 19.56:1 (WCAG AAA compliant)
- **Yellow row + Black button border**: Clear boundary definition

## Files Modified

1. **`frontend/uknf-project/src/app/features/library/library-list/library-list.component.css`** (+35 lines)
   - Added button visibility override rules after row hover styles
   - Ensures download button remains visible when row is hovered
   - Added button hover interaction (scale effect)

2. **`frontend/uknf-project/src/app/features/messages/messages-list/messages-list.component.css`** (+35 lines)
   - Applied identical fix for consistency
   - Ensures any action buttons in messages table remain visible

## CSS Specificity Strategy

**Why This Works:**

```css
/* Lower specificity - applies to all elements */
tr:hover * { color: #000000 !important; }

/* Higher specificity - overrides for buttons */
tr:hover button { color: #FFFF00 !important; }
tr:hover button * { color: #FFFF00 !important; }
```

The more specific selector (`tr:hover button`) beats the wildcard (`tr:hover *`) in CSS cascade, even though both have `!important`.

**Specificity Calculation:**
- `tr:hover *`: 0-0-1-2 (2 elements, 1 pseudo-class, 1 universal)
- `tr:hover button`: 0-0-1-3 (3 elements, 1 pseudo-class) **← WINS**

## Testing Checklist

✅ Library page:
1. Hover over any file row → row turns yellow
2. Download button should be visible (black background, yellow text)
3. Hover over download button → should scale slightly
4. Button remains clickable and accessible

✅ Messages page:
1. Hover over any message row → row turns yellow
2. Any action buttons should remain visible
3. Button hover states work correctly

## Accessibility Impact

**Before Fix:**
- ❌ Buttons invisible on row hover
- ❌ Keyboard users couldn't see focused element
- ❌ Screen reader users heard buttons but couldn't see them
- ❌ WCAG 2.2 Level A failure (1.4.1 Use of Color)

**After Fix:**
- ✅ Buttons always visible with sufficient contrast
- ✅ Visual feedback on both row hover and button hover
- ✅ Keyboard focus remains visible
- ✅ WCAG 2.2 Level AAA compliant (contrast ratio 19.56:1)
- ✅ Clear interaction affordance with scale effect

## Key Learnings

### ⚠️ Wildcard Selector Hazards

Using `* { }` in complex UIs can have unintended consequences:
- Wildcards override specific element styling
- Always need explicit overrides for interactive elements (buttons, inputs, links)
- Consider using more specific selectors instead of wildcards

### ✅ Defensive CSS Pattern

When styling container hover states, always account for:
1. Text elements (spans, labels)
2. Interactive elements (buttons, inputs, links)
3. Icons and decorative elements
4. Nested components

**Recommended Pattern:**
```css
/* Container hover */
.container:hover { background: yellow; }

/* Text children */
.container:hover span,
.container:hover p { color: black; }

/* Interactive children - MORE SPECIFIC */
.container:hover button { 
  background: black; 
  color: yellow; 
}
```

## Related Issues Prevented

This fix also prevents similar issues with:
- Link elements in table cells
- Icon-only buttons
- Custom action dropdowns
- Future table components with interactive elements

## Conclusion

Fixed button visibility issue by adding explicit CSS rules that override the wildcard selector for buttons within hovered table rows. Buttons now maintain proper contrast (black background, yellow text) against the yellow row background, ensuring visibility and WCAG AAA compliance.

The fix is applied to both library-list and messages-list components for consistency across the application.

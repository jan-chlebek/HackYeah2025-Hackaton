# Prompt: Implement wiadomości (messages) page

**Date:** 2025-10-05_022020  
**Branch:** main

## User Request
Implement wiadomości page which will look like attached pictures

## Attached Screenshots Analysis
The user provided three screenshots showing:
1. **Messages List View**: A comprehensive table with filtering panel showing messages with columns for identyfikator, sygnatura sprawy, podmiot, status wiadomości, priorytet, dates, users, and message content previews
2. **Expanded Filter Panel**: Shows detailed search filters including text inputs, dropdowns for status and priority, date pickers, and checkboxes for "Moje podmioty" and "Wymagana odpowiedź UKNF"
3. **Message Details Modal**: A dialog for editing/viewing message details with priority radio buttons (Niski/Średni/Wysoki), status dropdown, user and date fields, message content textarea, attachments section with download/add/edit/delete buttons

## Implementation Approach

### 1. Updated MessageService (message.service.ts)
- Added `MessageFilters` interface with comprehensive filtering options:
  - identyfikator, sygnaturaSprawy, podmiot
  - statusWiadomosci, priorytet
  - Date ranges for both podmiot and UKNF submissions
  - uzytkownik, pracownikUKNF
  - Boolean filters for mojePodmioty and wymaganaOdpowiedzUKNF
- Enhanced `getMessages()` method to accept filters, sorting field, and sort order
- Added `updateMessage()` method for editing message details
- All filters are optional and dynamically added to HTTP params

### 2. Messages List Component (messages-list.component.ts)
**TypeScript Implementation:**
- Imported PrimeNG modules: TableModule, ButtonModule, InputTextModule, SelectModule, DatePickerModule, CheckboxModule, BreadcrumbModule, DialogModule
- Created comprehensive component with:
  - Breadcrumb navigation (Pulpit użytkownika > Wnioski o dostęp > Biblioteka > Wiadomości)
  - Filter state management with collapsible panel
  - Pagination state (page, pageSize with options: 10, 25, 50, 100)
  - Status options: Oczekuje na odpowiedź UKNF, Odpowiedziano, Zamknięta
  - Priority options: Niski, Średni, Wysoki
  - Selected message state for details modal
- Implemented key methods:
  - `loadMessages()`: Fetches messages with current filters and pagination
  - `onPageChange()`: Handles pagination events
  - `toggleFilters()`: Shows/hides filter panel
  - `applyFilters()`: Applies filters and resets to page 1
  - `clearFilters()`: Resets all filters
  - `viewMessageDetails()`: Opens modal with selected message
  - `formatDate()`: Formats dates in Polish locale (dd-MM-yyyy HH:mm)
  - `getPriorityClass()` & `getStatusClass()`: Returns CSS classes for badges

**HTML Template (messages-list.component.html):**
- Breadcrumb with proper ARIA labels
- Page header with "Wiadomości" title
- Collapsible filter section with:
  - Grid layout for filter fields (responsive)
  - Text inputs for identyfikator, sygnatura, podmiot, users
  - Dropdowns (p-select) for status and priority
  - Date pickers (p-datepicker) for date ranges
  - Checkboxes for boolean filters
  - Action buttons: "Wyczyść" and "Szukaj"
- Comprehensive p-table with:
  - All required columns matching the screenshot
  - Loading state
  - Lazy pagination
  - Striped rows
  - Hover effects
  - Status and priority badges with color coding
  - "Szczegóły" button in actions column
  - Empty message handling
- Modal dialog (p-dialog) for message details:
  - Editable priority (radio buttons)
  - Status dropdown
  - User and date fields
  - Message content textareas
  - Attachments sections with action buttons
  - Footer with "Anuluj" and "Zapisz i wyślij" buttons

**CSS Styling (messages-list.component.css):**
- Followed UKNF color palette:
  - Primary blue (#003366) for headers and primary actions
  - Accent blue (#0073E6) for links and highlights
  - Light blue (#E6F3FF) for backgrounds and hover states
  - Proper gray scale for text and borders
- Implemented status badges:
  - Pending: Yellow/amber with border
  - Answered: Light blue with primary border
  - Closed: Green with border
- Implemented priority badges:
  - High: Red/pink background
  - Medium: Yellow/amber background
  - Low: Cyan/blue background
- Filter panel with smooth expand/collapse animation
- Responsive grid layouts for filters and form fields
- Table styling with proper padding, borders, and hover effects
- Modal dialog styling with sections and proper spacing
- Attachment list styling with download buttons
- High contrast mode support
- Focus states for accessibility
- Responsive breakpoints for mobile devices
- Loading and empty state styling

### 3. Design System Compliance
- Used PrimeNG components as specified in frontend instructions
- Applied WCAG 2.2 AA accessibility standards:
  - Proper ARIA labels
  - Keyboard navigation support
  - Focus indicators
  - Semantic HTML
  - Color contrast ratios (4.5:1 minimum)
- Polish language labels throughout
- Responsive design with mobile-first approach
- High contrast mode overrides included

### 4. Key Features Implemented
✅ Breadcrumb navigation with proper routing  
✅ Collapsible filter panel with expand/collapse animation  
✅ Comprehensive filtering: text search, dropdowns, date ranges, checkboxes  
✅ Data table with all required columns  
✅ Status and priority color-coded badges  
✅ Pagination with customizable page size  
✅ Message details modal dialog  
✅ Editable message fields in modal  
✅ Attachments display and management UI  
✅ Responsive layout for all screen sizes  
✅ Accessibility features (ARIA, focus states, keyboard navigation)  
✅ Loading states  
✅ Empty state handling  
✅ Polish locale date formatting  

## Files Modified/Created
1. **Modified:** `frontend/uknf-project/src/app/services/message.service.ts`
   - Added MessageFilters interface
   - Enhanced getMessages() with filtering and sorting
   - Added updateMessage() method

2. **Modified:** `frontend/uknf-project/src/app/features/messages/messages-list/messages-list.component.ts`
   - Completely rewrote component with full functionality
   - Added all imports for PrimeNG modules
   - Implemented filter management, pagination, modal handling

3. **Created:** `frontend/uknf-project/src/app/features/messages/messages-list/messages-list.component.html`
   - Comprehensive template matching all three screenshots
   - Breadcrumb, filters, table, and modal dialog
   - Proper ARIA labels and semantic HTML

4. **Created:** `frontend/uknf-project/src/app/features/messages/messages-list/messages-list.component.css`
   - Complete styling matching UKNF design system
   - Color-coded badges for status and priority
   - Responsive layouts
   - Accessibility features

## Technical Decisions
1. **PrimeNG Component Selection:**
   - Used `p-select` instead of deprecated `p-dropdown`
   - Used `p-datepicker` instead of deprecated `p-calendar`
   - All components from PrimeNG 20.x standalone modules

2. **Filtering Strategy:**
   - Client-side filter state management
   - Server-side filtering via query parameters
   - Reset to page 1 when filters change
   - Clear all filters functionality

3. **Accessibility:**
   - All form elements have associated labels with `for` attribute
   - ARIA labels on interactive elements
   - Focus states with proper outline
   - High contrast mode support
   - Keyboard navigation fully functional

4. **Responsive Design:**
   - Mobile-first approach with breakpoints
   - Grid layouts that stack on small screens
   - Dialog width adapts to viewport
   - Filter panel collapses by default on mobile

5. **Polish Locale:**
   - All labels in Polish
   - Date formatting: dd-MM-yyyy HH:mm
   - Currency: PLN (if needed in future)
   - Proper Polish terminology throughout

## Testing Considerations
- Unit tests needed for filter application logic
- Integration tests for API calls with various filter combinations
- E2E tests for user journey: navigate → filter → view details → edit
- Accessibility tests with axe-core
- Visual regression tests for table and modal layouts
- Keyboard navigation testing
- Screen reader compatibility testing

## Future Enhancements
- Real-time updates for new messages
- Message composition from this view
- Bulk actions (mark multiple messages)
- Export filtered results to CSV/Excel
- Advanced search with saved filters
- Message threading/conversation view
- File upload for attachments
- Drag-and-drop file management
- Message status change notifications
- WYSIWYG editor for message content

## Notes
- Backend API needs to support all filter parameters
- Attachment download functionality needs backend endpoint
- Message update endpoint must handle partial updates
- Consider implementing optimistic UI updates for better UX
- Add debouncing to text input filters (300ms recommended)
- Consider virtual scrolling for very large result sets (1000+ messages)

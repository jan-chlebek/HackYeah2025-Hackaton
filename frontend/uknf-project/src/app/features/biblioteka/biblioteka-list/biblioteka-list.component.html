<div class="biblioteka-container">
  <!-- Page Title -->
  <h1 class="page-title">Biblioteka - repozytorium plików</h1>
  
  <!-- Search Section -->
  <section class="search-section">
    <h2 class="section-title">Wyszukiwanie</h2>
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (ngModelChange)="applyFilters()"
        class="search-input" 
        placeholder="Szukaj..."
        aria-label="Wyszukaj pliki"
      />
    </div>
  </section>
  
  <!-- Table Section -->
  <section class="table-section">
    <!-- Column Filters -->
    <div class="column-filters">
      <div class="filter-group">
        <label for="dataFilter">Data aktualizacji</label>
        <select 
          id="dataFilter"
          [(ngModel)]="dataAktualizacjiFilter" 
          (change)="applyFilters()"
          class="filter-select"
        >
          <option value="">Wszystkie</option>
          <option value="2024-09-14">2024-09-14</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="nazwaFilter">Nazwa pliku</label>
        <select 
          id="nazwaFilter"
          [(ngModel)]="nazwaPlikiuFilter" 
          (change)="applyFilters()"
          class="filter-select"
        >
          <option value="">Wszystkie</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="okresFilter">Okres sprawozdawczy</label>
        <select 
          id="okresFilter"
          [(ngModel)]="okresSprawozdawczyFilter" 
          (change)="applyFilters()"
          class="filter-select"
        >
          <option value="">Wszystkie</option>
          <option value="Kwartal">Kwartal</option>
          <option value="Rok">Rok</option>
        </select>
      </div>
    </div>
    
    <!-- Data Table -->
    <div class="table-wrapper">
      <table class="data-table" role="table" aria-label="Tabela plików w repozytorium">
        <thead>
          <tr>
            <th scope="col" class="checkbox-col">
              <input 
                type="checkbox" 
                (change)="toggleAllSelection()"
                aria-label="Zaznacz wszystkie"
              />
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('dataAktualizacji')"
              [attr.aria-sort]="sortColumn === 'dataAktualizacji' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Data aktualizacji
              <span class="sort-icon">{{ getSortIcon('dataAktualizacji') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('nazwaPliku')"
              [attr.aria-sort]="sortColumn === 'nazwaPliku' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Nazwa pliku
              <span class="sort-icon">{{ getSortIcon('nazwaPliku') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('okresSprawozdawczy')"
              [attr.aria-sort]="sortColumn === 'okresSprawozdawczy' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Okres sprawozdawczy
              <span class="sort-icon">{{ getSortIcon('okresSprawozdawczy') }}</span>
            </th>
            <th scope="col" class="action-col">
              Pobierz
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let file of getPaginatedFiles()" [class.selected]="file.selected">
            <td class="checkbox-col">
              <input 
                type="checkbox" 
                [(ngModel)]="file.selected"
                [attr.aria-label]="'Zaznacz ' + file.nazwaPliku"
              />
            </td>
            <td>{{ file.dataAktualizacji }}</td>
            <td>{{ file.nazwaPliku }}</td>
            <td>{{ file.okresSprawozdawczy || '-' }}</td>
            <td class="action-col">
              <button 
                class="btn-download"
                aria-label="Pobierz {{ file.nazwaPliku }}"
              >
                Pobierz
              </button>
            </td>
          </tr>
          <tr *ngIf="getPaginatedFiles().length === 0">
            <td colspan="5" class="no-data">Brak danych do wyświetlenia</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination" role="navigation" aria-label="Paginacja tabeli">
      <div class="pagination-info">
        <span>Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalItems }} entries</span>
      </div>
      
      <div class="pagination-controls">
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(1)"
          aria-label="Pierwsza strona"
        >
          «
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(currentPage - 1)"
          aria-label="Poprzednia strona"
        >
          ‹
        </button>
        <button 
          *ngFor="let page of getPageNumbers()"
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="changePage(page)"
          [attr.aria-current]="page === currentPage ? 'page' : null"
        >
          {{ page }}
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(currentPage + 1)"
          aria-label="Następna strona"
        >
          ›
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(getTotalPages())"
          aria-label="Ostatnia strona"
        >
          »
        </button>
      </div>
      
      <div class="items-per-page">
        <select 
          [(ngModel)]="itemsPerPage" 
          (change)="onItemsPerPageChange()"
          aria-label="Liczba wierszy na stronę"
        >
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
  </section>
  
  <!-- Action Buttons -->
  <section class="action-buttons">
    <button 
      class="btn-action btn-add" 
      (click)="dodajFile()"
      aria-label="Dodaj nowy plik"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="btn-text">Dodaj</span>
    </button>
    <button 
      class="btn-action btn-edit" 
      (click)="modyfikujFile()"
      aria-label="Modyfikuj wybrany plik"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14.5 2.5C14.8978 2.10217 15.4374 1.87868 16 1.87868C16.2786 1.87868 16.5544 1.93355 16.8118 2.04016C17.0692 2.14677 17.303 2.30301 17.5 2.5C17.697 2.69698 17.8532 2.9308 17.9598 3.18819C18.0665 3.44558 18.1213 3.72142 18.1213 4C18.1213 4.27857 18.0665 4.55442 17.9598 4.81181C17.8532 5.0692 17.697 5.30302 17.5 5.5L6.5 16.5L2 18L3.5 13.5L14.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="btn-text">Modyfikuj</span>
    </button>
    <button 
      class="btn-action btn-view" 
      (click)="podgladFile()"
      aria-label="Podgląd wybranego pliku"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 10C1 10 4 4 10 4C16 4 19 10 19 10C19 10 16 16 10 16C4 16 1 10 1 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span class="btn-text">Podgląd</span>
    </button>
    <button 
      class="btn-action btn-delete" 
      (click)="usunFile()"
      aria-label="Usuń wybrane pliki"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2.5 5H4.16667H17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M6.66667 5V3.33333C6.66667 2.89131 6.84226 2.46738 7.15482 2.15482C7.46738 1.84226 7.89131 1.66667 8.33333 1.66667H11.6667C12.1087 1.66667 12.5326 1.84226 12.8452 2.15482C13.1577 2.46738 13.3333 2.89131 13.3333 3.33333V5M15.8333 5V16.6667C15.8333 17.1087 15.6577 17.5326 15.3452 17.8452C15.0326 18.1577 14.6087 18.3333 14.1667 18.3333H5.83333C5.39131 18.3333 4.96738 18.1577 4.65482 17.8452C4.34226 17.5326 4.16667 17.1087 4.16667 16.6667V5H15.8333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="btn-text">Usuń</span>
    </button>
    <button 
      class="btn-action btn-history" 
      (click)="historiaFile()"
      aria-label="Zobacz historię wybranego pliku"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 10C18.3333 5.39763 14.6024 1.66667 10 1.66667C5.39763 1.66667 1.66667 5.39763 1.66667 10C1.66667 14.6024 5.39763 18.3333 10 18.3333Z" stroke="currentColor" stroke-width="2"/>
        <path d="M10 5V10L13.3333 11.6667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="btn-text">Historia</span>
    </button>
    <button 
      class="btn-action btn-export" 
      (click)="eksportujFiles()"
      aria-label="Eksportuj wybrane pliki"
    >
      <svg class="btn-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M17.5 12.5V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M5.83333 8.33333L10 12.5L14.1667 8.33333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M10 12.5V2.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="btn-text">Eksportuj</span>
    </button>
  </section>

  <!-- Add File Modal -->
  <div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
      <div class="modal-header">
        <h2 id="modalTitle" class="modal-title">Repozytorium plików - dodaj plik</h2>
        <button class="modal-close" (click)="closeAddModal()" aria-label="Zamknij">×</button>
      </div>
      
      <div class="modal-body">
        <!-- Archiwalny Checkbox -->
        <div class="form-group checkbox-inline">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="addFileForm.archiwalny"
              aria-label="Archiwalny"
            />
            Archiwalny
          </label>
        </div>
        
        <!-- Form Fields Row 1 -->
        <div class="form-row-modal">
          <div class="form-group-modal">
            <label for="nazwaPliku">Nazwa pliku *</label>
            <input 
              type="text" 
              id="nazwaPliku"
              [(ngModel)]="addFileForm.nazwaPliku"
              class="form-control-modal"
              required
            />
          </div>
          
          <div class="form-group-modal">
            <label for="okresSprawozdawczy">Okres sprawozdawczy</label>
            <input 
              type="text" 
              id="okresSprawozdawczy"
              [(ngModel)]="addFileForm.okresSprawozdawczy"
              class="form-control-modal"
            />
          </div>
          
          <div class="form-group-modal">
            <label for="dataAktualizacji">Data aktualizacji</label>
            <input 
              type="date" 
              id="dataAktualizacji"
              [(ngModel)]="addFileForm.dataAktualizacji"
              class="form-control-modal"
            />
          </div>
        </div>
        
        <!-- Załącznik Section -->
        <div class="form-group-modal">
          <label for="zalacznik">Załącznik *</label>
          <div class="attachment-section">
            <input 
              type="text" 
              [(ngModel)]="addFileForm.zalacznikName"
              class="form-control-modal attachment-input"
              readonly
              placeholder="Testowy_zalacznik.pdf"
            />
            <input 
              type="file" 
              id="fileUpload"
              (change)="onFileSelect($event)"
              style="display: none;"
            />
            
            <div class="attachment-buttons">
              <button class="btn-attachment" (click)="przegladajZalacznik()">
                Przeglądaj
              </button>
              <button class="btn-attachment" (click)="usunZalacznikModal()">
                <span class="btn-icon">🗑</span>
                Usuń
              </button>
              <button class="btn-attachment" (click)="historiaZalacznik()">
                <span class="btn-icon">📄</span>
                Historia
              </button>
              <button class="btn-attachment" (click)="pobierzZalacznikModal()">
                <span class="btn-icon">⬇</span>
                Pobierz
              </button>
              <button class="btn-attachment" (click)="podgladZalacznik()">
                <span class="btn-icon">🔍</span>
                Podgląd
              </button>
            </div>
          </div>
        </div>
        
        <!-- Adresaci powiadomień Section -->
        <div class="adresaci-section">
          <h3 class="section-subtitle">Adresaci powiadomień</h3>
          
          <div class="form-group-modal">
            <label for="nazwaPodmiotu">Nazwa podmiotu</label>
            <select 
              id="nazwaPodmiotu"
              [(ngModel)]="addFileForm.adresaciPowiadomien"
              class="form-control-modal"
            >
              <option value="">Wybierz...</option>
              <option value="podmiot1">Podmiot 1</option>
              <option value="podmiot2">Podmiot 2</option>
            </select>
          </div>
          
          <div class="adresaci-groups">
            <div class="form-group-modal">
              <label for="adresatGrupa1">Adresaci grupa pierwsza</label>
              <input 
                type="text" 
                id="adresatGrupa1"
                [(ngModel)]="addFileForm.adresatGrupa1"
                class="form-control-modal"
                readonly
              />
            </div>
            
            <div class="form-group-modal">
              <label for="adresatGrupa2">Adresaci grupa druga</label>
              <input 
                type="text" 
                id="adresatGrupa2"
                [(ngModel)]="addFileForm.adresatGrupa2"
                class="form-control-modal"
                readonly
              />
            </div>
            
            <div class="form-group-modal">
              <label for="adresatGrupa3">Adresaci grupa trzecia</label>
              <input 
                type="text" 
                id="adresatGrupa3"
                [(ngModel)]="addFileForm.adresatGrupa3"
                class="form-control-modal"
                readonly
              />
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <!-- First Row of Buttons -->
        <div class="modal-buttons-row">
          <button class="btn-modal" (click)="wybierzAction()">Wybierz</button>
          <button class="btn-modal" (click)="utworzIDodaj()">Utwórz i dodaj</button>
          <button class="btn-modal" (click)="podgladAction()">Podgląd</button>
          <button class="btn-modal" (click)="edycjaAction()">Edycja</button>
          <button class="btn-modal" (click)="usunAction()">Usuń</button>
        </div>
        
        <!-- Second Row of Buttons -->
        <div class="modal-buttons-row modal-buttons-right">
          <button class="btn-modal btn-secondary" (click)="anulujAction()">Anuluj</button>
          <button class="btn-modal btn-primary" (click)="zapiszIWyslij()">Zapisz i wyślij</button>
          <button class="btn-modal btn-primary" (click)="zapiszIZamknij()">Zapisz i zamknij</button>
        </div>
      </div>
    </div>
  </div>
</div>

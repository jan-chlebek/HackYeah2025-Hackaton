<div class="wiadomosci-container">
  <!-- Page Title -->
  <h1 class="page-title">Wiadomości</h1>
  
  <!-- Search Section -->
  <section class="search-section">
    <h2 class="section-title">Wyszukiwanie</h2>
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (ngModelChange)="applyFilters()"
        class="search-input" 
        placeholder="Szukaj..."
        aria-label="Wyszukaj wiadomości"
      />
    </div>
  </section>
  
  <!-- Table Section -->
  <section class="table-section">
    <!-- Data Table -->
    <div class="table-wrapper">
      <table class="data-table messages-table" role="table" aria-label="Tabela wiadomości">
        <thead>
          <tr>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('identyfikator')"
              [attr.aria-sort]="sortColumn === 'identyfikator' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Identyfikator
              <span class="sort-icon">{{ getSortIcon('identyfikator') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('sygnaturaSprawy')"
              [attr.aria-sort]="sortColumn === 'sygnaturaSprawy' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Sygnatura sprawy
              <span class="sort-icon">{{ getSortIcon('sygnaturaSprawy') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('podmiot')"
              [attr.aria-sort]="sortColumn === 'podmiot' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Podmiot
              <span class="sort-icon">{{ getSortIcon('podmiot') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('statusWiadomosci')"
              [attr.aria-sort]="sortColumn === 'statusWiadomosci' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Status wiadomości
              <span class="sort-icon">{{ getSortIcon('statusWiadomosci') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('priorytet')"
              [attr.aria-sort]="sortColumn === 'priorytet' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Priorytet
              <span class="sort-icon">{{ getSortIcon('priorytet') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('dataPrzeslaniaPodmiotu')"
              [attr.aria-sort]="sortColumn === 'dataPrzeslaniaPodmiotu' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Data przesłania podmiotu
              <span class="sort-icon">{{ getSortIcon('dataPrzeslaniaPodmiotu') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('uzytkownik')"
              [attr.aria-sort]="sortColumn === 'uzytkownik' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Użytkownik
              <span class="sort-icon">{{ getSortIcon('uzytkownik') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('wiadomoscUzytkownika')"
              [attr.aria-sort]="sortColumn === 'wiadomoscUzytkownika' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Wiadomość użytkownika
              <span class="sort-icon">{{ getSortIcon('wiadomoscUzytkownika') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('dataPrzeslaniaUKNF')"
              [attr.aria-sort]="sortColumn === 'dataPrzeslaniaUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Data przesłania UKNF
              <span class="sort-icon">{{ getSortIcon('dataPrzeslaniaUKNF') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('pracownikUKNF')"
              [attr.aria-sort]="sortColumn === 'pracownikUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Pracownik UKNF
              <span class="sort-icon">{{ getSortIcon('pracownikUKNF') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('wiadomoscPracownikaUKNF')"
              [attr.aria-sort]="sortColumn === 'wiadomoscPracownikaUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Wiadomość pracownika UKNF
              <span class="sort-icon">{{ getSortIcon('wiadomoscPracownikaUKNF') }}</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let message of getPaginatedMessages()">
            <td>{{ message.identyfikator }}</td>
            <td>{{ message.sygnaturaSprawy }}</td>
            <td>{{ message.podmiot }}</td>
            <td>{{ message.statusWiadomosci }}</td>
            <td>{{ message.priorytet }}</td>
            <td>{{ message.dataPrzeslaniaPodmiotu }}</td>
            <td>{{ message.uzytkownik }}</td>
            <td class="message-preview">{{ message.wiadomoscUzytkownika }}</td>
            <td>{{ message.dataPrzeslaniaUKNF || '-' }}</td>
            <td>{{ message.pracownikUKNF || '-' }}</td>
            <td class="message-preview">{{ message.wiadomoscPracownikaUKNF || '-' }}</td>
          </tr>
          <tr *ngIf="getPaginatedMessages().length === 0">
            <td colspan="11" class="no-data">Brak danych do wyświetlenia</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination" role="navigation" aria-label="Paginacja tabeli">
      <div class="pagination-info">
        <span>Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalItems }} entries</span>
      </div>
      
      <div class="pagination-controls">
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(1)"
          aria-label="Pierwsza strona"
        >
          «
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(currentPage - 1)"
          aria-label="Poprzednia strona"
        >
          ‹
        </button>
        <button 
          *ngFor="let page of getPageNumbers()"
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="changePage(page)"
          [attr.aria-current]="page === currentPage ? 'page' : null"
        >
          {{ page }}
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(currentPage + 1)"
          aria-label="Następna strona"
        >
          ›
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(getTotalPages())"
          aria-label="Ostatnia strona"
        >
          »
        </button>
      </div>
      
      <div class="items-per-page">
        <select 
          [(ngModel)]="itemsPerPage" 
          (change)="onItemsPerPageChange()"
          aria-label="Liczba wierszy na stronę"
        >
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
  </section>
  
  <!-- Action Button -->
  <section class="action-section">
    <button 
      class="btn-details" 
      (click)="viewMessageDetails(getPaginatedMessages()[0])"
      [disabled]="getPaginatedMessages().length === 0"
      aria-label="Zobacz szczegóły wiadomości"
    >
      Szczegóły wiadomości
    </button>
  </section>
</div>

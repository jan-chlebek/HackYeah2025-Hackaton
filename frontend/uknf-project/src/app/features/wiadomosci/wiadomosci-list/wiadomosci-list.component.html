<div class="wiadomosci-container">
  <!-- Page Title -->
  <h1 class="page-title">Wiadomości</h1>
  
  <!-- Filter Section -->
  <section class="filter-section">
    <div class="filter-header">
      <h2 class="section-title">
        Wyszukiwanie
        <button 
          type="button"
          class="toggle-filters-btn" 
          (click)="toggleFilters()"
          [attr.aria-expanded]="showFilters"
          aria-label="Przełącz filtry"
        >
          {{ showFilters ? '▲' : '▼' }}
        </button>
      </h2>
    </div>
    
    <div class="filter-content" [class.expanded]="showFilters">
      <div class="filter-grid">
        <!-- Row 1 -->
        <div class="filter-field filter-field-full">
          <label for="identyfikatorFilter" class="filter-label">Identyfikator</label>
          <input 
            type="text" 
            id="identyfikatorFilter"
            [(ngModel)]="identyfikatorFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-input"
            aria-label="Filtruj po identyfikatorze"
          />
        </div>
        
        <div class="filter-field filter-field-full">
          <label for="sygnaturaFilter" class="filter-label">Sygnatura sprawy</label>
          <input 
            type="text" 
            id="sygnaturaFilter"
            [(ngModel)]="sygnaturaSprawyFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-input"
            aria-label="Filtruj po sygnaturze sprawy"
          />
        </div>
        
        <!-- Row 2 -->
        <div class="filter-field filter-field-full">
          <label for="priorytetFilter" class="filter-label">Priorytet</label>
          <select 
            id="priorytetFilter"
            [(ngModel)]="priorytetFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-select"
            aria-label="Filtruj po priorytecie"
          >
            <option value="">Wszystkie</option>
            <option *ngFor="let priorytet of priorytetOptions" [value]="priorytet">{{ priorytet }}</option>
          </select>
        </div>
        
        <div class="filter-field filter-field-full">
          <label for="dataPodmiotuFromFilter" class="filter-label">Data przesłania podmiotu</label>
          <input 
            type="date" 
            id="dataPodmiotuFromFilter"
            [(ngModel)]="dataPrzeslaniaPodmiotuFromFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-input filter-date"
            placeholder="dd.mm.rrrr"
            aria-label="Data przesłania podmiotu od"
          />
        </div>
      </div>
      
      <!-- Checkboxes Row -->
      <div class="checkbox-row">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="mojePodmiotyFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-checkbox"
            aria-label="Moje podmioty"
          />
          <span>Moje podmioty</span>
        </label>
        
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="wymaganaOdpowiedzUKNFFilter" 
            (ngModelChange)="applyFilters()"
            class="filter-checkbox"
            aria-label="Wymagana odpowiedź UKNF"
          />
          <span>Wymagana odpowiedź UKNF</span>
        </label>
      </div>
      
      <!-- Action Buttons -->
      <div class="filter-actions">
        <button 
          type="button"
          class="btn-clear" 
          (click)="clearFilters()"
          aria-label="Wyczyść filtry"
        >
          Wyczyść
        </button>
        <button 
          type="button"
          class="btn-search" 
          (click)="applyFilters()"
          aria-label="Szukaj"
        >
          Szukaj
        </button>
      </div>
    </div>
  </section>
  
  <!-- Table Section -->
  <section class="table-section">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <p>Ładowanie wiadomości...</p>
    </div>
    
    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-state">
      <p>{{ errorMessage }}</p>
    </div>
    
    <!-- Data Table -->
    <div class="table-wrapper" *ngIf="!isLoading && !errorMessage">
      <table class="data-table messages-table" role="table" aria-label="Tabela wiadomości">
        <thead>
          <tr>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('identyfikator')"
              [attr.aria-sort]="sortColumn === 'identyfikator' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Identyfikator
              <span class="sort-icon">{{ getSortIcon('identyfikator') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('sygnaturaSprawy')"
              [attr.aria-sort]="sortColumn === 'sygnaturaSprawy' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Sygnatura sprawy
              <span class="sort-icon">{{ getSortIcon('sygnaturaSprawy') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('podmiot')"
              [attr.aria-sort]="sortColumn === 'podmiot' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Podmiot
              <span class="sort-icon">{{ getSortIcon('podmiot') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('statusWiadomosci')"
              [attr.aria-sort]="sortColumn === 'statusWiadomosci' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Status wiadomości
              <span class="sort-icon">{{ getSortIcon('statusWiadomosci') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('priorytet')"
              [attr.aria-sort]="sortColumn === 'priorytet' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Priorytet
              <span class="sort-icon">{{ getSortIcon('priorytet') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('dataPrzeslaniaPodmiotu')"
              [attr.aria-sort]="sortColumn === 'dataPrzeslaniaPodmiotu' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Data przesłania podmiotu
              <span class="sort-icon">{{ getSortIcon('dataPrzeslaniaPodmiotu') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('uzytkownik')"
              [attr.aria-sort]="sortColumn === 'uzytkownik' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Użytkownik
              <span class="sort-icon">{{ getSortIcon('uzytkownik') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('wiadomoscUzytkownika')"
              [attr.aria-sort]="sortColumn === 'wiadomoscUzytkownika' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Wiadomość użytkownika
              <span class="sort-icon">{{ getSortIcon('wiadomoscUzytkownika') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('dataPrzeslaniaUKNF')"
              [attr.aria-sort]="sortColumn === 'dataPrzeslaniaUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Data przesłania UKNF
              <span class="sort-icon">{{ getSortIcon('dataPrzeslaniaUKNF') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('pracownikUKNF')"
              [attr.aria-sort]="sortColumn === 'pracownikUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Pracownik UKNF
              <span class="sort-icon">{{ getSortIcon('pracownikUKNF') }}</span>
            </th>
            <th 
              scope="col" 
              class="sortable" 
              (click)="sortBy('wiadomoscPracownikaUKNF')"
              [attr.aria-sort]="sortColumn === 'wiadomoscPracownikaUKNF' ? (sortDirection === 'asc' ? 'ascending' : 'descending') : 'none'"
            >
              Wiadomość pracownika UKNF
              <span class="sort-icon">{{ getSortIcon('wiadomoscPracownikaUKNF') }}</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let message of getPaginatedMessages()">
            <td>{{ message.identyfikator || '-' }}</td>
            <td>{{ message.sygnaturaSprawy || '-' }}</td>
            <td>{{ message.podmiot || '-' }}</td>
            <td>{{ message.statusWiadomosci || '-' }}</td>
            <td>{{ message.priorytet || '-' }}</td>
            <td>{{ formatDate(message.dataPrzeslaniaPodmiotu) }}</td>
            <td>{{ message.uzytkownik || '-' }}</td>
            <td class="message-preview">{{ message.wiadomoscUzytkownika || '-' }}</td>
            <td>{{ formatDate(message.dataPrzeslaniaUKNF) }}</td>
            <td>{{ message.pracownikUKNF || '-' }}</td>
            <td class="message-preview">{{ message.wiadomoscPracownikaUKNF || '-' }}</td>
          </tr>
          <tr *ngIf="getPaginatedMessages().length === 0">
            <td colspan="11" class="no-data">Brak wiadomości do wyświetlenia</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Pagination -->
    <div class="pagination" role="navigation" aria-label="Paginacja tabeli">
      <div class="pagination-info">
        <span>Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalItems }} entries</span>
      </div>
      
      <div class="pagination-controls">
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(1)"
          aria-label="Pierwsza strona"
        >
          «
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === 1"
          (click)="changePage(currentPage - 1)"
          aria-label="Poprzednia strona"
        >
          ‹
        </button>
        <button 
          *ngFor="let page of getPageNumbers()"
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="changePage(page)"
          [attr.aria-current]="page === currentPage ? 'page' : null"
        >
          {{ page }}
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(currentPage + 1)"
          aria-label="Następna strona"
        >
          ›
        </button>
        <button 
          class="page-btn"
          [disabled]="currentPage === getTotalPages()"
          (click)="changePage(getTotalPages())"
          aria-label="Ostatnia strona"
        >
          »
        </button>
      </div>
      
      <div class="items-per-page">
        <select 
          [(ngModel)]="itemsPerPage" 
          (change)="onItemsPerPageChange()"
          aria-label="Liczba wierszy na stronę"
        >
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
  </section>
</div>

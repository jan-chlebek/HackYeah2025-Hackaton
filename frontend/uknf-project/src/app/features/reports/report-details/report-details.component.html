<div class="report-details-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <i class="pi pi-spin pi-spinner"></i>
    <p>Ładowanie szczegółów sprawozdania...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <i class="pi pi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button pButton label="Wróć do listy" icon="pi pi-arrow-left" (click)="goBack()"></button>
  </div>

  <!-- Report Details -->
  <div *ngIf="report && !loading" class="details-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="report-title">
          <h1 class="page-title">{{ report.nazwaPliku }}</h1>
          <span 
            class="status-badge" 
            [ngClass]="getStatusBadgeClass(report.statusWalidacji)">
            {{ getStatusBadgeLabel(report.statusWalidacji) }}
          </span>
        </div>
        <p class="page-subtitle">Numer sprawozdania: {{ report.numerSprawozdania || 'N/A' }}</p>
      </div>
      <div class="header-actions">
        <button 
          pButton 
          label="Pobierz raport walidacji" 
          icon="pi pi-download" 
          class="p-button-primary"
          [disabled]="!report.raportWalidacjiUrl"
          (click)="downloadValidationReport()">
        </button>
        <button 
          pButton 
          label="Złóż korektę" 
          icon="pi pi-pencil" 
          class="p-button-outlined"
          (click)="goToCorrection()">
        </button>
        <button 
          pButton 
          label="Wróć do listy" 
          icon="pi pi-arrow-left" 
          class="p-button-outlined"
          (click)="goBack()">
        </button>
      </div>
    </div>

    <!-- Details Grid -->
    <div class="details-grid">
      <!-- Basic Information -->
      <p-card header="Podstawowe informacje" styleClass="detail-card">
        <div class="detail-row">
          <span class="detail-label">Podmiot:</span>
          <span class="detail-value">{{ report.podmiotNazwa }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Okres sprawozdawczy:</span>
          <span class="detail-value">{{ report.okresSprawozdawczy }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Data złożenia:</span>
          <span class="detail-value">{{ formatDate(report.dataZlozenia) }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Wielkość pliku:</span>
          <span class="detail-value">{{ formatFileSize(report.wielkoscPliku) }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Korekta:</span>
          <span class="detail-value">
            <span *ngIf="report.czyKorekta" class="correction-badge">
              <i class="pi pi-exclamation-circle"></i> Tak
            </span>
            <span *ngIf="!report.czyKorekta">Nie</span>
          </span>
        </div>
      </p-card>

      <!-- User Information -->
      <p-card header="Użytkownik" styleClass="detail-card">
        <div class="detail-row">
          <span class="detail-label">Imię i nazwisko:</span>
          <span class="detail-value">{{ report.uzytkownikImie }} {{ report.uzytkownikNazwisko }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Email:</span>
          <span class="detail-value">
            <a [href]="'mailto:' + report.uzytkownikEmail">{{ report.uzytkownikEmail }}</a>
          </span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Telefon:</span>
          <span class="detail-value">{{ report.uzytkownikTelefon || '-' }}</span>
        </div>
      </p-card>

      <!-- Validation Information -->
      <p-card header="Informacje o walidacji" styleClass="detail-card validation-card">
        <div class="detail-row">
          <span class="detail-label">Status walidacji:</span>
          <span class="detail-value">
            <span 
              class="status-badge" 
              [ngClass]="getStatusBadgeClass(report.statusWalidacji)">
              {{ getStatusBadgeLabel(report.statusWalidacji) }}
            </span>
          </span>
        </div>
        <div class="detail-row" *ngIf="report.dataWalidacji">
          <span class="detail-label">Data walidacji:</span>
          <span class="detail-value">{{ formatDate(report.dataWalidacji) }}</span>
        </div>
        <div class="detail-row" *ngIf="report.opisBledow">
          <span class="detail-label">Opis błędów:</span>
          <span class="detail-value error-text">{{ report.opisBledow }}</span>
        </div>
        <div class="detail-row" *ngIf="report.raportWalidacjiUrl">
          <span class="detail-label">Raport walidacji:</span>
          <span class="detail-value">
            <button 
              pButton 
              label="Pobierz PDF" 
              icon="pi pi-file-pdf" 
              class="p-button-sm p-button-outlined"
              (click)="downloadValidationReport()">
            </button>
          </span>
        </div>
      </p-card>
    </div>

    <!-- Status History Timeline -->
    <p-card header="Historia statusów" styleClass="detail-card timeline-card">
      <p-timeline [value]="statusHistory" align="alternate" styleClass="custom-timeline">
        <ng-template pTemplate="marker" let-event>
          <span class="custom-marker" [ngClass]="getStatusBadgeClass(event.status)">
            <i class="pi pi-circle-fill"></i>
          </span>
        </ng-template>
        <ng-template pTemplate="content" let-event>
          <div class="timeline-content">
            <div class="timeline-header">
              <span 
                class="status-badge" 
                [ngClass]="getStatusBadgeClass(event.status)">
                {{ getStatusBadgeLabel(event.status) }}
              </span>
              <span class="timeline-date">{{ formatDate(event.dataZmiany) }}</span>
            </div>
            <p class="timeline-description">{{ event.uwagi }}</p>
            <p class="timeline-user" *ngIf="event.uzytkownikNazwisko">
              <i class="pi pi-user"></i> {{ event.uzytkownikNazwisko }}
            </p>
          </div>
        </ng-template>
      </p-timeline>
    </p-card>
  </div>
</div>
